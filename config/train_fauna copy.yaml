hydra:
  run:
    dir: .
  output_subdir: ${checkpoint_dir}


defaults:
  - base_fauna
  - dataset: fauna
  - model: fauna


dataset:
  in_image_size: 256
  out_image_size: 256
  batch_size: 6
  train_data_dir: data/fauna/Fauna_dataset
  val_data_dir: data/fauna/Fauna_dataset
  test_data_dir: data/fauna/Fauna_dataset
  random_shuffle_samples_train: false
  load_dino_feature: true
  dino_feature_dim: 16
  random_xflip_train: true


# ===== 안정성 개선을 위한 추가 설정 =====
training:
  # Gradient clipping (메시 붕괴 방지)
  grad_clip_norm: 1.0
  
  # Warmup (초기 불안정성 방지)
  warmup_iters: 1000
  warmup_lr_factor: 0.1
  
  # Loss weights (기존 값 오버라이드)
  loss_weights:
    # SDF regularization 강화
    sdf_bce_reg: 2.0          # 기본값(~1.4)보다 높게
    sdf_gradient_reg: 0.3     # 기본값(~0.15)보다 높게
    
    # Mesh smoothing 추가
    laplacian_smooth: 0.01
    
    # 기존 loss는 유지
    mask_loss: 1.0
    rgb_loss: 1.0
    dino_feat_loss: 1.0

optimizer:
  type: AdamW
  lr: 0.0001  # 기본값의 1/2로 감소 (안정성 향상)
  betas: [0.9, 0.999]
  weight_decay: 0.01
  
  # Learning rate scheduler 추가
  scheduler:
    type: ExponentialLR
    gamma: 0.9999  # 점진적 감소

# Checkpoint 설정
checkpoint:
  save_interval: 100  # 더 자주 저장
  keep_latest: 10     # 최근 10개 유지
  resume_from: null   # 재시작 시: "results/fauna/exp/checkpoints/checkpoint_XXXXX.pth"
  resume_optimizer: true  # false로 설정하면 optimizer 상태 리셋

# DMTet 설정 (안정성 우선)
model:
  dmtet:
    grid_res: 64       # 128→64로 낮춤 (더 안정적)
    deform_scale: 1.0  # deformation 제한
  
  # SDF 초기화 개선
  sdf_init_type: "sphere"  # 안정적인 초기화
  sdf_init_radius: 0.5


run_train: true
run_test: false
seed: 0
gpu: 1
num_iters: 900000
checkpoint_dir: results/fauna/exp
